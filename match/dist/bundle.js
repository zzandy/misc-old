!function(t){var e={};function n(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(s,o,function(e){return t[e]}.bind(null,o));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.deg=e.tau=e.array=void 0,e.array=(t,e)=>{const n=new Array(t);for(let s=0;s<t;++s)n[s]=e(s);return n},e.tau=2*Math.PI,e.deg=Math.PI/180},function(t,e,n){"use strict";function s(t,e){return"number"==typeof e&&"number"==typeof t?Math.floor(t+Math.random()*(e-t)):"number"==typeof t?Math.floor(t*Math.random()):t instanceof Array?t[Math.floor(t.length*Math.random())]:Math.random()}Object.defineProperty(e,"__esModule",{value:!0}),e.shuffle=e.array=e.rnd=void 0,e.rnd=s,e.array=function(t,e,n){const s=[];for(let o=0;o<e;++o){const e=[];for(let s=0;s<t;++s)e.push(n(o,s));s.push(e)}return s},e.shuffle=function(t){for(let e=t.length-1;e>0;--e){const n=s(e+1);[t[e],t[n]]=[t[n],t[e]]}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.newVector=e.Vector=e.AABB=void 0;e.AABB=class{constructor(t,e,n,s){this.x=t,this.y=e,this.w=n,this.h=s}contains(t){const{x:e,y:n,w:s,h:o}=this;return t.x>=e&&t.y>=n&&t.x<e+s&&t.y<n+o}intersects(t){const{x:e,y:n,w:s,h:o}=this;return!(e+s<t.x||n+o<t.y||t.x+t.w<e||t.y+t.h<n)}};class s{constructor(t,e){this.x=t,this.y=e}get mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}add(t){return new s(this.x+t.x,this.y+t.y)}times(t){return new s(t*this.x,t*this.y)}distance(t){const e=t.x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)}}e.Vector=s,e.newVector=(t,e)=>new s(Math.cos(t)*e,Math.sin(t)*e)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=n(4),o=n(5),r=n(1),i=n(2),a=n(0),c=n(7),l=500;let h=0;function d(t,e){r.rnd()<.5&&([t,e]=[e,t]);let n=r.rnd(t.length),s=r.rnd(t.length),o=r.rnd(e.length),i=r.rnd(e.length);n>s&&([n,s]=[s,n]),o>i&&([o,i]=[i,o]);const a=t.slice(0,n).concat(e.slice(o,i)).concat(t.slice(s));if(r.rnd()<.3){const t=r.rnd(["flip","drop","spawn"]),e=r.rnd(a.length);switch(t){case"flip":a[e]=u();break;case"drop":a.splice(e,1);break;case"spawn":a.splice(e,0,u())}}return a}function u(){return new c.Command(0,r.rnd(300,700),i.newVector(r.rnd(180)*a.deg,r.rnd(20,30)),r.rnd(400))}new s.Loop(1e3/60,(function(){const t=new o.Renderer,{width:e,height:n}=t,s=new i.AABB(-e/2,0,e,n),h=a.array(l,t=>new c.Rocket(0,100,new i.Vector(0,-.015),a.array(r.rnd(10,30),u),t/l)),d=[new i.AABB(-e/4,.4*n,e/2,n/20),new i.AABB(-e/2,.7*n,e/3,n/20),new i.AABB(e/6,.7*n,e/3,n/20)];return{renderer:t,rockets:h,area:s,explosions:[],goals:[new i.Vector(-e/3,.9*n),new i.Vector(e/3,.9*n)],obstacles:d,wins:0,first:0,best:0,bestCommands:0,avgCommands:0,avgCommandsCount:0}}),(function(t,e){e.explosions=e.explosions.filter(e=>(e.advance(t),e.isAlive));let n=0,s=0;for(let o of e.rockets){if(o.isDead)continue;o.advance(t);const r=e.goals.reduce((t,e)=>Math.min(t,e.distance(o.pos)),1/0),i=r<50,a=(50/r-h/1e3/7/3)/(i?1:2);o.score(a),i&&(e.wins++,0==e.first&&(e.first=h/1e3)),e.best=Math.max(e.best,o.bestScore),e.best==o.bestScore&&(e.bestCommands=o.commands.length),i||!e.area.contains(o.pos)||e.obstacles.some(t=>t.contains(o.pos))?(e.explosions.every(t=>t.pos.distance(o.pos)>30||t.age/t.lifespan>.2)&&e.explosions.push(new c.Explosion(o.pos)),o.isDead=!0):(s+=o.commands.length,++n)}n>0&&(e.avgCommands+=s,e.avgCommandsCount+=n);if((h+=t)>7e3||0==n){h=0,console.log(e.best.toFixed(3),e.wins,e.first.toFixed(2),e.bestCommands,(e.avgCommands/e.avgCommandsCount).toFixed(1)),e.best=e.wins=e.first=e.bestCommands=0;const t=e.rockets;t.sort((t,e)=>e.bestScore-t.bestScore),e.rockets=[];let n=0;for(;e.rockets.length<l;){let s=t[r.rnd()*r.rnd()*l|0],o=t[r.rnd()*r.rnd()*l|0];if(s==o)continue;const a=d(s.commands,o.commands);a.length>=10&&a.length<30&&e.rockets.push(new c.Rocket(0,100,new i.Vector(0,-.015),a,++n/l))}}return e}),(function(t,e){e.renderer.draw(e.goals,e.obstacles,e.rockets,e.explosions,e.area)})).start()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Loop=void 0;e.Loop=class{constructor(t,e,n,s){this.fixedDelta=t,this.init=e,this.fixed=n,this.variable=s,this.isRunning=!1,this.fixedAccum=0}start(){if(this.isRunning)return;let t=this.init();this.isRunning=!0;let e=0;const n=s=>{const o=0==e,r=o?0:s-e;e=s,t=this.update(r,t,o),this.isRunning&&requestAnimationFrame(n)};requestAnimationFrame(n)}stop(){this.isRunning=!1}update(t,e,n=!1){let s=e;this.fixedAccum+=t;let o=!1;if(n)s=this.fixed(this.fixedDelta,s),o=!0;else for(;this.fixedAccum>this.fixedDelta;)this.fixedAccum-=this.fixedDelta,s=this.fixed(this.fixedDelta,s),o=!0;return o&&this.variable(t,s),s}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Renderer=void 0;const s=n(6),o=n(0);e.Renderer=class{constructor(){this.ctx=s.fullscreenCanvas()}draw(t,e,n,s,r){const{ctx:i,width:a,height:c}=this;i.save(),i.clearRect(0,0,a,c);const l=.5+(0|Math.min(c/50,a/50)),h=a-2*l,d=c-2*l;i.scale(h/r.w,-d/r.h),i.translate(l-r.x,-l-r.y-r.h),i.strokeStyle="#aaa",i.strokeRect(r.x,r.y,r.w,r.h);for(let t of e)i.strokeRect(t.x,t.y,t.w,t.h);i.fillStyle="gold";for(let e of t)i.fillCircle(e.x,e.y,10),i.strokeCircle(e.x,e.y,50);i.fillStyle="white";for(let t of s)i.fillCircle(t.pos.x,t.pos.y,t.age/5),i.globalCompositeOperation="destination-out",i.fillCircle(t.pos.x,t.pos.y,Math.max(0,t.age/5-5)),i.globalCompositeOperation="source-over";for(let t of n)t.isDead||(i.save(),i.translate(t.pos.x,t.pos.y),i.strokeCircle(0,0,10),i.beginPath(),i.moveTo(0,0),i.lineTo(20*Math.cos(o.tau*t.a),20*Math.sin(o.tau*t.a)),i.stroke(),i.scale(10,10),i.beginPath(),i.moveTo(0,0),i.lineTo(-8*t.burnVector.x,-8*t.burnVector.y),i.strokeStyle="red",i.stroke(),i.restore());this.ctx.restore()}get width(){return this.ctx.canvas.width}get height(){return this.ctx.canvas.height}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.fullscreenCanvas=e.fullscreenCanvas3d=e.getCanvas=void 0,e.getCanvas=(t=!1)=>{const e=document.createElement("canvas");return e.width=window.innerWidth,e.height=window.innerHeight,t||(e.style.position="absolute",e.style.top="0",e.style.left="0"),e},e.fullscreenCanvas3d=(t=!1)=>{const n=e.getCanvas(t),s=n.getContext("webgl");if(null==s)throw new Error("failed to get 'webgl' context");return document.body.appendChild(n),s},e.fullscreenCanvas=function(t=!1,n=!1){const s=e.getCanvas(t),o=s.getContext("2d",{alpha:!n});if(null==o)throw new Error("failed to get '2d' context");return o.clear=function(){return o.clearRect(0,0,o.canvas.width,o.canvas.height),o},o.makePath=function(t){o.beginPath(),o.moveTo(t[0],t[1]);for(var e=2;e<t.length;e+=2)o.lineTo(t[e],t[e+1]);return o.closePath(),o},o.strokeCircle=function(t,e,n){return o.beginPath(),o.arc(t,e,n,0,2*Math.PI,!0),o.closePath(),o.stroke(),o},o.fillCircle=function(t,e,n){return o.beginPath(),o.arc(t,e,n,0,2*Math.PI,!0),o.closePath(),o.fill(),o},document.body.style.margin="0",document.body.appendChild(s),o}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Explosion=e.Command=e.Rocket=void 0;const s=n(1),o=n(2);e.Rocket=class{constructor(t,e,n,s,r){this.gravity=n,this.commands=s,this.a=r,this.commandIndex=0,this.timer=0,this.state="lead-in",this.burnVector=new o.Vector(0,0),this.vector=new o.Vector(0,0),this.bestScore=0,this.isDead=!1,this.pos=new o.Vector(t,e)}score(t){this.bestScore=Math.max(this.bestScore,t)}advance(t){let e=t,n=this.commands[this.commandIndex],s=new o.Vector(0,0),r=!0;for(;r;)switch(r=!1,this.state){case"lead-in":this.timer+e>n.leadTime?(e-=n.leadTime-this.timer,this.timer=0,this.state="burn",r=!0):this.timer+=e;break;case"burn":if(this.timer+e>n.burnTime){const t=n.burnTime-this.timer;s=s.add(n.vector.times(t/1e3)),e-=t,this.timer=0,this.state="lead-out",r=!0}else s=s.add(n.vector.times(e/1e3)),this.timer+=e;break;case"lead-out":this.timer+e>n.outTime?(e-=n.outTime-this.timer,this.timer=0,this.commandIndex=++this.commandIndex%this.commands.length,n=this.commands[this.commandIndex],this.state="lead-in",r=!0):this.timer+=e}this.burnVector=s,this.vector=this.vector.add(s).add(this.gravity.times(t)),this.pos=this.pos.add(this.vector)}};e.Command=class{constructor(t,e,n,s){this.leadTime=t,this.burnTime=e,this.vector=n,this.outTime=s}};e.Explosion=class{constructor(t){this.pos=t,this.age=0,this.lifespan=s.rnd(500,1e3)}advance(t){this.age+=t}get isAlive(){return this.age<this.lifespan}}}]);