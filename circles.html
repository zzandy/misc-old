<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8" />
    <title>Circles</title>
    <style type="text/css">
        html,
        body {
            background-color: #232220;
            color: #dad6d0
        }
    </style>
</head>

<body>
    <div style="position: fixed; z-index: 10;">
        <label>Width:
            <input id="w" type="number" value="4" />
        </label>
        <label>Height:
            <input id="h" type="number" value="4" />
        </label>

        <label>Total:
            <input id="total" type="number" readonly />
        </label>

        <label>Extra:
            <input id="extra" type="number" readonly />
        </label>
    </div>

    <script type="text/javascript">
        (function () {
            document.createElement('canvas');
            var c = document.createElement('canvas');
            ctx = c.getContext('2d');

            ctx.w = ctx.canvas.width = window.innerWidth;
            ctx.h = ctx.canvas.height = window.innerHeight;
            ctx.canvas.style.position = 'absolute';
            ctx.canvas.style.top = 0;
            ctx.canvas.style.left = 0;

            document.body.appendChild(c);
        })();
    </script>

    <script type="text/javascript">
        // hue Chroma luma
        function hcy2rgb(h, c, y, a) {
            h = h % 360;

            // 601
            var r = .3;
            var g = .59;
            var b = .11;

            var h0 = h;
            h /= 60;

            var k = (1 - Math.abs((h % 2) - 1));

            var K = h < 1 ? r + k * g
                : h < 2 ? g + k * r
                    : h < 3 ? g + k * b
                        : h < 4 ? b + k * g
                            : h < 5 ? b + k * r
                                : r + k * b;

            var cmax = 1;

            if (y <= 0 || y >= 1) cmax = 0;
            else cmax *= K < y ? (y - 1) / (K - 1) : K > y ? y / K : 1;
            //c *= cmax;
            c = Math.min(c, cmax);

            var x = c * k;
            var rgb = h < 1 ? [c, x, 0]
                : h < 2 ? [x, c, 0]
                    : h < 3 ? [0, c, x]
                        : h < 4 ? [0, x, c]
                            : h < 5 ? [x, 0, c]
                                : [c, 0, x];

            var m = y - (r * rgb[0] + g * rgb[1] + b * rgb[2]);

            var rgbdata = [rgb[0] + m, rgb[1] + m, rgb[2] + m];
            return 'rgba(' + (rgbdata[0] * 255).toFixed(0) + ',' + (rgbdata[1] * 255).toFixed(0) + ',' + (rgbdata[2] * 255).toFixed(0) + ',' + (a || 1) + ')';
        }

        function wheel2rgb(h, c, y, a) {
            var h2 = h < 180 ? 2 * h / 3 : 120 + (h - 180) * 4 / 3;

            return hcy2rgb(h, c, y, a)
        }
    </script>

    <script type="text/javascript">

        function rnd(a) {
            return Math.floor(Math.random() * a) | 0;
        }

        const tau = Math.PI * 2;

        CanvasRenderingContext2D.prototype.fillCircle = function (x, y, r) {
            this.beginPath();
            this.arc(x, y, r, 0, tau, false)
            this.closePath();
            this.fill();
        }

        CanvasRenderingContext2D.prototype.strokeCircle = function (x, y, r) {
            this.beginPath();
            this.arc(x, y, r, 0, tau, false)
            this.closePath();
            this.stroke();
        }
    </script>

    <script type="text/javascript">
        main();

        function main() {
            ['w', 'h'].map(id => document.getElementById(id)).forEach(e => {
                e.addEventListener('input', updateSize);
            });
            updateSize();
        }

        function updateSize() {
            renderCircles.apply(null, 'w,h'.split(',').map(id => parseInt(document.getElementById(id).value, 10)));
        }

        function renderCircles(w, h) {

            const plateColor = hcy2rgb(0, 1, .3);
            const rectColor = hcy2rgb(60, 1, .6);
            const hexColor = hcy2rgb(100, 1, .5);

            const sq32 = Math.sqrt(3) / 2;

            const width = ctx.canvas.width;
            const height = ctx.canvas.height;

            const pad = width * .03;

            const rw = (width - 3 * pad) / 2;
            const rh = height - 2 * pad;

            const sar = w / h;
            const tar = rw / rh;

            const s = sar > tar ? rw / w : rh / h;

            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

            var hue = rnd(360);
            const oy = height / 2 - s * h / 2;

            // render rect
            ctx.strokeStyle = plateColor;
            ctx.strokeRect(pad, oy, s * w, s * h);

            ctx.strokeStyle = rectColor;
            for (let i = 0; i < w; ++i) {
                for (let j = 0; j < h; ++j) {
                    ctx.strokeCircle(pad + i * s + s / 2, oy + s * j + s / 2, s / 2);
                }
            }

            // render hex
            let n = w * h;
            let extra = 0;

            let i = 0;
            let j = 0;

            const mar = pad * 2 + w * s;

            ctx.strokeStyle = plateColor;
            ctx.strokeRect(mar, oy, s * w, s * h);
            ctx.strokeStyle = rectColor;

            while (true) {
                if (i >= w - j % 2) {
                    j += 1;

                    i = 0;
                }

                n--;
                if (n < 0 && j * sq32 + 1 > h) break;

                ctx.strokeCircle(mar + s / 2 + j % 2 * s / 2 + s * i, oy + s * j * sq32 + s / 2, s / 2);
                ++i;

                if (n == 0) ctx.strokeStyle = hexColor;
                if (n < 0) extra++;
                if (j * sq32 + 1 > h) extra--;

            }

            document.getElementById('total').value = w * h;
            document.getElementById('extra').value = extra;
        }

    </script>
</body>

</html>