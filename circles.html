<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8" />
    <title>Circles</title>
    <style type="text/css">
        html,
        body {
            background-color: #232220;
            color: #dad6d0
        }
    </style>
</head>

<body>
    <div style="position: fixed; z-index: 10;">
        <label>Width:
            <input id="w" type="number" value="4" />
        </label>
        <label>Height:
            <input id="h" type="number" value="4" />
        </label>
    </div>


    <script type="text/javascript">
        (function () {
            document.createElement('canvas');
            var c = document.createElement('canvas');
            ctx = c.getContext('2d');

            ctx.w = ctx.canvas.width = window.innerWidth;
            ctx.h = ctx.canvas.height = window.innerHeight;
            ctx.canvas.style.position = 'absolute';
            ctx.canvas.style.top = 0;
            ctx.canvas.style.left = 0;

            ctx.clear = function () {
                ctx.clearRect(-ctx.canvas.width / 2, -ctx.canvas.height / 2, ctx.canvas.width, ctx.canvas.height);
            };

            document.body.appendChild(c);
        })();
    </script>

    <script type="text/javascript">
        // hue Chroma luma
        function hcy2rgb(h, c, y, a) {
            h = h % 360;

            // 601
            var r = .3;
            var g = .59;
            var b = .11;

            var h0 = h;
            h /= 60;

            var k = (1 - Math.abs((h % 2) - 1));

            var K = h < 1 ? r + k * g
                : h < 2 ? g + k * r
                    : h < 3 ? g + k * b
                        : h < 4 ? b + k * g
                            : h < 5 ? b + k * r
                                : r + k * b;

            var cmax = 1;

            if (y <= 0 || y >= 1) cmax = 0;
            else cmax *= K < y ? (y - 1) / (K - 1) : K > y ? y / K : 1;
            //c *= cmax;
            c = Math.min(c, cmax);

            var x = c * k;
            var rgb = h < 1 ? [c, x, 0]
                : h < 2 ? [x, c, 0]
                    : h < 3 ? [0, c, x]
                        : h < 4 ? [0, x, c]
                            : h < 5 ? [x, 0, c]
                                : [c, 0, x];

            var m = y - (r * rgb[0] + g * rgb[1] + b * rgb[2]);

            var rgbdata = [rgb[0] + m, rgb[1] + m, rgb[2] + m];
            return 'rgba(' + (rgbdata[0] * 255).toFixed(0) + ',' + (rgbdata[1] * 255).toFixed(0) + ',' + (rgbdata[2] * 255).toFixed(0) + ',' + (a || 1) + ')';
        }

        function wheel2rgb(h, c, y, a) {
            var h2 = h < 180 ? 2 * h / 3 : 120 + (h - 180) * 4 / 3;

            return hcy2rgb(h, c, y, a)
        }
    </script>

    <script type="text/javascript">

        function rnd(a) {
            return Math.floor(Math.random() * a) | 0;
        }

        const tau = Math.PI * 2;

        CanvasRenderingContext2D.prototype.fillCircle = function (x, y, r) {
            this.beginPath();
            this.arc(x, y, r, 0, tau, false)
            this.closePath();
            this.fill();
        }

        CanvasRenderingContext2D.prototype.strokeCircle = function (x, y, r) {
            this.beginPath();
            this.arc(x, y, r, 0, tau, false)
            this.closePath();
            this.stroke();
        }
    </script>

    <script type="text/javascript">

        main();

        function main() {
            ['w', 'h'].map(id => document.getElementById(id)).forEach(e => {
                e.addEventListener('input', updateSize);
                //e.addEventListener('change', updateSize);
            });
            updateSize();
        }

        function updateSize() {
            renderCircles.apply(null, 'w,h'.split(',').map(id => parseInt(document.getElementById(id).value, 10)));
        }

        function renderCircles(w, h) {
            const sq32 = Math.sqrt(3) / 2;

            var width = ctx.canvas.width;
            var height = ctx.canvas.height;

            var pad = width * .03;

            var s = 2 * (width - pad * 3) / 5 / w;

            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

            var hue = rnd(360);

            // render rect
            ctx.strokeStyle = hcy2rgb(hue, 1, .5);
            for (var i = 0; i < w; ++i) {
                for (var j = 0; j < h; ++j) {
                    ctx.strokeCircle(pad + i * s + s / 2, height / 2 - s * h / 2 + s * j + s / 2, s / 2);
                }
            }

            ctx.strokeRect(pad * 2 + i * s, height / 2 - s * h / 2, s * w, s * h)

            // render hex
            ctx.strokeStyle = hcy2rgb(hue + 120, 1, .5);
            console.log(hue, hue + 120)
            for (var i = 0; i < w; ++i) {
                for (var j = 0; j < h; ++j) {
                    ctx.strokeCircle(pad * 2 + w * s + s / 2 + j % 2 * s / 2 + s * i, height / 2 - s * h / 2 + s * j * sq32 + s / 2, s / 2);
                }
            }
        }

    </script>
</body>

</html>